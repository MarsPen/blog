
<h1 align="center">ğŸ“–ç»„ä»¶æ³¨å†Œåˆ†æ</h1>

åœ¨æ—¥å¸¸å¼€å‘ä¸­æˆ‘ä»¬ç»å¸¸ä¼šç”¨åˆ°è®¸å¤šè‡ªå®šä¹‰çš„ç»„ä»¶ï¼Œé™¤äº†å†…ç½®ç»„ä»¶è‡ªå®šä¹‰ç»„ä»¶ç”¨çš„æ—¶å€™å¿…é¡»æ³¨å†Œï¼Œå¦åˆ™ä¼šæç¤ºå¦‚ä¸‹ä¿¡æ¯

```md
'Unknown custom element: <xxx> - did you register the component correctly?
 For recursive components, make sure to provide the "name" option.'
```

åœ¨<a href="https://cn.vuejs.org/v2/guide/components-registration.html">å®˜ç½‘</a>ä¸­æåˆ°ç»„ä»¶ç»„å†Œçš„æ–¹å¼åˆ†ä¸ºå…¨å±€å’Œå±€éƒ¨

### å…¨å±€æ³¨å†Œ

```js
Vue.component('my-component-name', {
  // ... é€‰é¡¹ ...
})
```

å®˜æ–¹æ–‡æ¡£ä¸­æœ‰è¿™æ ·ä¸€å¥è¯ **å…¨å±€æ³¨å†Œçš„è¡Œä¸ºå¿…é¡»åœ¨æ ¹ Vue å®ä¾‹ (é€šè¿‡ new Vue) åˆ›å»ºä¹‹å‰å‘ç”Ÿ** ï¼Œé‚£ä¹ˆä»£ç è¢«å®šä¹‰åœ¨ `src/core/global-api/assets.js ` ä¸­

```js
import { ASSET_TYPES } from 'shared/constants'
import { isPlainObject, validateComponentName } from '../util/index'

export function initAssetRegisters (Vue: GlobalAPI) {
  // åˆ›å»ºæ³¨å†Œçš„æ–¹æ³•
  ASSET_TYPES.forEach(type => {
    Vue[type] = function (
      id: string,
      definition: Function | Object
    ): Function | Object | void {
      if (!definition) {
        return this.options[type + 's'][id]
      } else {
        /* istanbul ignore if */
        if (process.env.NODE_ENV !== 'production' && type === 'component') {
          validateComponentName(id)
        }
        if (type === 'component' && isPlainObject(definition)) {
          definition.name = definition.name || id
          definition = this.options._base.extend(definition)
        }
        if (type === 'directive' && typeof definition === 'function') {
          definition = { bind: definition, update: definition }
        }
        this.options[type + 's'][id] = definition
        return definition
      }
    }
  })
}
```
éå† ASSET_TYPESï¼Œå¾—åˆ° type åæŒ‚è½½åˆ° Vue ä¸Šï¼Œå®šä¹‰åœ¨ `src/shared/constants.js` ä¸­

```js
export const ASSET_TYPES = [
  'component',
  'directive',
  'filter'
]
```

å®é™…ä¸Š vue æ˜¯åˆå§‹åŒ–äº†3ä¸ªå…¨å±€å‡½æ•°ï¼Œé‚£ä¹ˆå¯¹äº component æ¥è¯´æ˜¯ä½¿ç”¨ Vue.extend æŠŠè¿™ä¸ªå¯¹è±¡è½¬æ¢æˆä¸€ä¸ªç»§æ‰¿äº Vue çš„æ„é€ å‡½æ•°ï¼Œæœ€åé€šè¿‡ `this.options[type + 's'][id] = definition` æŠŠå®ƒæŒ‚è½½åˆ° `Vue.options.components` ä¸Šã€‚ç„¶ååœ¨é€šè¿‡ mergeOptions è¿›è¡Œå‚æ•°åˆå¹¶ï¼Œæœ€ååœ¨åˆ›å»º vnode çš„æ—¶å€™æ‰§è¡Œ _createElement æ–¹æ³•ï¼Œå®šä¹‰åœ¨ `src/core/vdom/create-element.js` ä¸­
```js
export function _createElement (
  context: Component,
  tag?: string | Class<Component> | Function | Object,
  data?: VNodeData,
  children?: any,
  normalizationType?: number
): VNode | Array<VNode> {
  // ...
  let vnode, ns
  if (typeof tag === 'string') {
    let Ctor
    ns = (context.$vnode && context.$vnode.ns) || config.getTagNamespace(tag)
    if (config.isReservedTag(tag)) {
      // ...
    } else if (isDef(Ctor = resolveAsset(context.$options, 'components', tag))) {
      // component
      vnode = createComponent(Ctor, data, context, children, tag)
    } else {
    // ...
    }
  } else {
    // direct component options / constructor
    vnode = createComponent(tag, data, context, children)
  }
  // ...
}
```

é€šè¿‡ _createElement  æ–¹æ³•ä¸­çš„ resolveAsset æ‹¿åˆ°è¿™ä¸ªç»„ä»¶çš„æ„é€ å‡½æ•°ï¼Œå¹¶ä½œä¸º createComponent çš„é’©å­çš„å‚æ•°

```js
export function resolveAsset (
  options: Object,
  type: string,
  id: string,
  warnMissing?: boolean
): any {
  // ç»„ä»¶åç§°å¿…é¡»æ˜¯å­—ç¬¦ä¸²
  if (typeof id !== 'string') {
    return
  }
  const assets = options[type]
  // æ£€æŸ¥æœ¬åœ°çš„æ³¨å†Œå˜é‡
  if (hasOwn(assets, id)) return assets[id]
  const camelizedId = camelize(id)
  if (hasOwn(assets, camelizedId)) return assets[camelizedId]
  const PascalCaseId = capitalize(camelizedId)
  if (hasOwn(assets, PascalCaseId)) return assets[PascalCaseId]
  // å¦‚æœæ¡ä»¶éƒ½æ»¡è¶³é‚£ä¹ˆè¿”å›æ ‡å¿—ï¼Œè¿›è¡Œ createComponent
  const res = assets[id] || assets[camelizedId] || assets[PascalCaseId]
  if (process.env.NODE_ENV !== 'production' && warnMissing && !res) {
    warn(
      'Failed to resolve ' + type.slice(0, -1) + ': ' + id,
      options
    )
  }
  return res
}
```

ä¸Šé¢ä»£ç å¾ˆç›´è§‚çš„åˆ†æåˆ°å…³äºæˆ‘ä»¬å…³äºç»„ä»¶åå­—çš„æ³¨æ„äº‹é¡¹

- ç›´æ¥ä½¿ç”¨ id æ‹¿ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æŠŠ id å˜æˆé©¼å³°çš„å½¢å¼å†æ‹¿
- å¦‚æœä»ç„¶ä¸å­˜åœ¨åˆ™åœ¨é©¼å³°çš„åŸºç¡€ä¸ŠæŠŠé¦–å­—æ¯å†å˜æˆå¤§å†™çš„å½¢å¼å†æ‹¿
- å¦‚æœä»ç„¶æ‹¿ä¸åˆ°åˆ™æŠ¥é”™

è¿™æ ·è¯´æ˜äº†æˆ‘ä»¬åœ¨ä½¿ç”¨ Vue.component(id, definition) å…¨å±€æ³¨å†Œç»„ä»¶çš„æ—¶å€™ï¼Œid å¯ä»¥æ˜¯è¿å­—ç¬¦ã€é©¼å³°æˆ–é¦–å­—æ¯å¤§å†™çš„å½¢å¼ã€‚é‚£ä¹ˆåœ¨åœ¨<a href="https://cn.vuejs.org/v2/guide/components-registration.html">å®˜ç½‘</a>ä¸­å…³äºç»„ä»¶çš„å‘½ä»¤ä¹Ÿå†™åˆ°ä½¿ç”¨ kebab-case æ–¹å¼ æˆ–è€… ä½¿ç”¨ PascalCase æ–¹å¼

### å±€éƒ¨æ³¨å†Œ

```js
import ComponentA from './ComponentA.vue'

export default {
  components: {
    ComponentA
  },
  // ...
}

```

å…¶å®é€šè¿‡ä¸Šé¢å…¨å±€ç»„ä»¶çš„æ³¨å†Œï¼Œå±€éƒ¨ç»„ä»¶å°±å¾ˆå¥½ç†è§£äº†ï¼Œä¹Ÿæ˜¯ç»è¿‡å‚æ•°åˆå¹¶ï¼Œé€šè¿‡ resolveAsset æ‹¿åˆ°ç»„ä»¶çš„æ„é€ å‡½æ•°ï¼Œå¹¶ä½œä¸ºcreateComponent é’©å­çš„å‚æ•°ï¼ŒåŒºåˆ«æ˜¯å±€éƒ¨ç»„ä»¶åªæœ‰è¯¥ç±»å‹çš„ç»„ä»¶æ‰å¯ä»¥è®¿é—®å±€éƒ¨æ³¨å†Œçš„å­ç»„ä»¶ï¼Œè€Œå…¨å±€æ³¨å†Œæ˜¯æ‰©å±•åˆ° Vue.options ä¸‹ï¼Œæ‰€ä»¥åœ¨æ‰€æœ‰ç»„ä»¶åˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œéƒ½ä¼šä»å…¨å±€çš„ Vue.options.components æ‰©å±•åˆ°å½“å‰ç»„ä»¶çš„ vm.$options.components ä¸‹ï¼Œè¿™å°±æ˜¯å…¨å±€æ³¨å†Œçš„ç»„ä»¶èƒ½è¢«ä»»æ„ä½¿ç”¨çš„åŸå› ã€‚

### Vue.use

æˆ‘ä»¬éƒ½çŸ¥é“ä½¿ç”¨æ’ä»¶çš„è¯ vue æä¾›ä¸€ä¸ª Vue.use æ–¹æ³•ï¼Œå…·ä½“ç”¨æ³•è§<a href="https://cn.vuejs.org/v2/api/#Vue-use">å®˜ç½‘æ–‡æ¡£</a>  

é‚£ä¹ˆå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®šä¹‰åœ¨ `vue/src/core/index.js` ä¸­

```js
// ...

// åˆå§‹åŒ–å…¨å±€API
import { initGlobalAPI } from './global-api/index'

// ...

//åˆå§‹åŒ–å…¨å±€APIå˜é‡
initGlobalAPI(Vue)

// ...
export default Vue
```

initGlobalAPI å®šä¹‰åœ¨ `/src/core/global-api/index.js`

```js
export function initGlobalAPI (Vue: GlobalAPI) {
  // ...
  // åˆå§‹åŒ–use()
  initUse(Vue)
  // ...
}
```

initUse(Vue) å®šä¹‰åœ¨ `vue/src/core/global-api/use.js`

```js
export function initUse (Vue: GlobalAPI) {
  Vue.use = function (plugin: Function | Object) {
    // installedPlugins å­˜å‚¨ install åçš„æ’ä»¶
    const installedPlugins = (this._installedPlugins || (this._installedPlugins = []))
    if (installedPlugins.indexOf(plugin) > -1) {
      // åŒä¸€ä¸ªæ’ä»¶åªä¼šå®‰è£…ä¸€æ¬¡
      return this
    }
    // æ’ä»¶ä»¥å¤–çš„å…¶ä»–å‚æ•° Vue.use(MyPlugin, { someOption: true })
    const args = toArray(arguments, 1)
    args.unshift(this)
    if (typeof plugin.install === 'function') {
      // å¦‚æœæ’ä»¶æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¿…é¡»æä¾› install æ–¹æ³•
      plugin.install.apply(plugin, args)
    } else if (typeof plugin === 'function') {
      // å¦‚æœæ’ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¼šè¢«ä½œä¸º install æ–¹æ³•
      plugin.apply(null, args)
    }
    // install ä¹‹åé€šè¿‡é˜Ÿåˆ—å‚¨å­˜æ’ä»¶å†æ¬¡å®‰è£…æ—¶åŒ¹é…åˆ¤æ–­é¿å…é‡å¤å®‰è£…
    installedPlugins.push(plugin)
    return this
  }
}
```

é€šè¿‡ä¸Šé¢æˆ‘ä»¬æ€»ç»“åˆ°

- Vue.use å¯¹è±¡çš„åŸç†æ˜¯ä½¿ç”¨ install å­—æ®µï¼Œæ¥è¿›è¡Œæ’ä»¶å®‰è£…
- Vue.use è°ƒç”¨å¿…é¡»åœ¨ new Vue ä¹‹å‰
- åŒä¸€ä¸ªæ’ä»¶å¤šæ¬¡ä½¿ç”¨ Vue.use åªä¼šè¢«è¿è¡Œä¸€æ¬¡

















